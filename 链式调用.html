<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

  <script>

    // ! 链式调用的点语法  解析
    //    实际上就是在最后调用的时候  return this
    //    将需要执行的函数 this 固定指向   
    //    还是理解不深  无法用准确的语言去描述这个东西
    let ec = (
      function () {
        let handle = function (obj) {
          //深拷贝对象
          this.obj = JSON.parse(JSON.stringify(obj));
        };
        handle.prototype = {
          /**
           * @description 设置保密信息
           */
          setInfo() {
            this.obj.map(item => {
              for (let key in item) {
                if (item[key] === '') {
                  item[key] = '--';
                }
              }
            });
            console.log(this)
            return this;
          },
          /**
           * @description 设置状态
           */
          setStatus() {
            let _status = {
              0: '进行中',
              1: '已完成',
              2: '订单异常'
            }
            this.obj.forEach(item => {
              item.status = item.status.toString() ? _status[item.status] : ''
            });
            console.log('==>',this)
            return this;
          },
          /**
         * @description 设置时间
         */
          setStartTime() {
            this.obj.forEach(item => {
              item.startTime = item.startTime.toString() ? new Date(item.startTime).toLocaleDateString().replace(/\//g, '-') : '';
            });
            return this;
          },
          /**
         * @description 设置type
         */
          setType() {
            let _type = {
              0: '普通用户',
              1: 'vip',
              2: '超级vip'
            }
            this.obj.forEach(item => {
              item.type = item.type.toString() ? _type[item.type] : '';
            })
            return this;
          },
          /**
           * @description 返回处理结果
           * @return {Array|*}
           */
          end() {
            return this.obj;
          }
        }
        //暴露构造函数接口
        return function (obj) {
          console.log('暴露', obj)
          return new handle(obj);
        }
      })();

    console.log(ec([{ status: 1 }]).setStatus().end())
  </script>
</body>

</html>